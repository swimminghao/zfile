var ze=Object.defineProperty,Le=Object.defineProperties;var Ce=Object.getOwnPropertyDescriptors;var fe=Object.getOwnPropertySymbols;var Ee=Object.prototype.hasOwnProperty,Te=Object.prototype.propertyIsEnumerable;var me=(n,l,a)=>l in n?ze(n,l,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[l]=a,j=(n,l)=>{for(var a in l||(l={}))Ee.call(l,a)&&me(n,a,l[a]);if(fe)for(var a of fe(l))Te.call(l,a)&&me(n,a,l[a]);return n},J=(n,l)=>Le(n,Ce(l));var ve=(n,l,a)=>new Promise((o,m)=>{var k=d=>{try{R(a.next(d))}catch(g){m(g)}},i=d=>{try{R(a.throw(d))}catch(g){m(g)}},R=d=>d.done?o(d.value):Promise.resolve(d.value).then(k,i);R((a=a.apply(n,l)).next())});import{m as ge,u as V}from"./request.2ccc188b.js";import{d as te,an as pe,r as I,ao as Se,s as Oe,c as _,w as re,W as we,o as ye,a as h,b as ie,j as c,e as L,m as y,g as f,u as t,n as ue,h as xe,k as C,f as x,F as ee,l as Ne,v as Re,K as $e,L as Ae,i as Q,T as Ye,U as Xe,ap as Be,t as Ve,x as Me}from"./index.965ac11d.js";import{R as B,S as Fe,b as he,d as ce,ae as de,aF as De,aG as He,n as ke,a as be,K as Pe,E as N,i as We,aH as je,ag as Ke,aI as Ze,z as Ge,aJ as Ue,aK as qe,_ as Ie,av as X,aw as Je,w as _e,a8 as Qe,k as et,u as tt}from"./base.b65bdcd1.js";import{d as at}from"./debounce.da5c4ce9.js";import{u as nt}from"./index.22cf9654.js";import{g as st}from"./scroll.06c8f1a5.js";const lt=(n,l)=>{if(!B||!n||!l)return!1;const a=n.getBoundingClientRect();let o;return l instanceof Element?o=l.getBoundingClientRect():o={top:0,right:window.innerWidth,bottom:window.innerHeight,left:0},a.top<o.bottom&&a.bottom>o.top&&a.right>o.left&&a.left<o.right},Tt=n=>{let l,a;return n.type==="touchend"?(a=n.changedTouches[0].clientY,l=n.changedTouches[0].clientX):n.type.startsWith("touch")?(a=n.touches[0].clientY,l=n.touches[0].clientX):(a=n.clientY,l=n.clientX),{clientX:l,clientY:a}};var ot="Expected a function";function oe(n,l,a){var o=!0,m=!0;if(typeof n!="function")throw new TypeError(ot);return Fe(a)&&(o="leading"in a?!!a.leading:o,m="trailing"in a?!!a.trailing:m),at(n,l,{leading:o,maxWait:l,trailing:m})}const rt=he({urlList:{type:ce(Array),default:()=>ge([])},zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},hideOnClickModal:{type:Boolean,default:!1},teleported:{type:Boolean,default:!1},closeOnPressEscape:{type:Boolean,default:!0},zoomRate:{type:Number,default:1.2}}),it={close:()=>!0,switch:n=>de(n)},ut=["src"],ct=te({name:"ElImageViewer"}),dt=te(J(j({},ct),{props:rt,emits:it,setup(n,{expose:l,emit:a}){const o=n,m={CONTAIN:{name:"contain",icon:pe(De)},ORIGINAL:{name:"original",icon:pe(He)}},{t:k}=ke(),i=be("image-viewer"),{nextZIndex:R}=Pe(),d=I(),g=I([]),E=Se(),z=I(!0),v=I(o.initialIndex),p=Oe(m.CONTAIN),u=I({scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}),M=_(()=>{const{urlList:e}=o;return e.length<=1}),$=_(()=>v.value===0),K=_(()=>v.value===o.urlList.length-1),ae=_(()=>o.urlList[v.value]),F=_(()=>{const{scale:e,deg:s,offsetX:r,offsetY:w,enableTransition:S}=u.value;let b=r/e,O=w/e;switch(s%360){case 90:case-270:[b,O]=[O,-b];break;case 180:case-180:[b,O]=[-b,-O];break;case 270:case-90:[b,O]=[-O,b];break}const Y={transform:`scale(${e}) rotate(${s}deg) translate(${b}px, ${O}px)`,transition:S?"transform .3s":""};return p.value.name===m.CONTAIN.name&&(Y.maxWidth=Y.maxHeight="100%"),Y}),ne=_(()=>de(o.zIndex)?o.zIndex:R());function A(){se(),a("close")}function D(){const e=oe(r=>{switch(r.code){case X.esc:o.closeOnPressEscape&&A();break;case X.space:P();break;case X.left:U();break;case X.up:T("zoomIn");break;case X.right:q();break;case X.down:T("zoomOut");break}}),s=oe(r=>{const w=r.deltaY||r.deltaX;T(w<0?"zoomIn":"zoomOut",{zoomRate:o.zoomRate,enableTransition:!1})});E.run(()=>{V(document,"keydown",e),V(document,"wheel",s)})}function se(){E.stop()}function le(){z.value=!1}function Z(e){z.value=!1,e.target.alt=k("el.image.error")}function G(e){if(z.value||e.button!==0||!d.value)return;u.value.enableTransition=!1;const{offsetX:s,offsetY:r}=u.value,w=e.pageX,S=e.pageY,b=oe(Y=>{u.value=J(j({},u.value),{offsetX:s+Y.pageX-w,offsetY:r+Y.pageY-S})}),O=V(document,"mousemove",b);V(document,"mouseup",()=>{O()}),e.preventDefault()}function H(){u.value={scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}}function P(){if(z.value)return;const e=Je(m),s=Object.values(m),r=p.value.name,S=(s.findIndex(b=>b.name===r)+1)%e.length;p.value=m[e[S]],H()}function W(e){const s=o.urlList.length;v.value=(e+s)%s}function U(){$.value&&!o.infinite||W(v.value-1)}function q(){K.value&&!o.infinite||W(v.value+1)}function T(e,s={}){if(z.value)return;const{zoomRate:r,rotateDeg:w,enableTransition:S}=j({zoomRate:o.zoomRate,rotateDeg:90,enableTransition:!0},s);switch(e){case"zoomOut":u.value.scale>.2&&(u.value.scale=Number.parseFloat((u.value.scale/r).toFixed(3)));break;case"zoomIn":u.value.scale<7&&(u.value.scale=Number.parseFloat((u.value.scale*r).toFixed(3)));break;case"clockwise":u.value.deg+=w;break;case"anticlockwise":u.value.deg-=w;break}u.value.enableTransition=S}return re(ae,()=>{we(()=>{const e=g.value[0];e!=null&&e.complete||(z.value=!0)})}),re(v,e=>{H(),a("switch",e)}),ye(()=>{var e,s;D(),(s=(e=d.value)==null?void 0:e.focus)==null||s.call(e)}),l({setActiveItem:W}),(e,s)=>(h(),ie(Xe,{to:"body",disabled:!e.teleported},[c(Ye,{name:"viewer-fade",appear:""},{default:L(()=>[y("div",{ref_key:"wrapper",ref:d,tabindex:-1,class:f(t(i).e("wrapper")),style:ue({zIndex:t(ne)})},[y("div",{class:f(t(i).e("mask")),onClick:s[0]||(s[0]=xe(r=>e.hideOnClickModal&&A(),["self"]))},null,2),C(" CLOSE "),y("span",{class:f([t(i).e("btn"),t(i).e("close")]),onClick:A},[c(t(N),null,{default:L(()=>[c(t(We))]),_:1})],2),C(" ARROW "),t(M)?C("v-if",!0):(h(),x(ee,{key:0},[y("span",{class:f([t(i).e("btn"),t(i).e("prev"),t(i).is("disabled",!e.infinite&&t($))]),onClick:U},[c(t(N),null,{default:L(()=>[c(t(je))]),_:1})],2),y("span",{class:f([t(i).e("btn"),t(i).e("next"),t(i).is("disabled",!e.infinite&&t(K))]),onClick:q},[c(t(N),null,{default:L(()=>[c(t(Ke))]),_:1})],2)],64)),C(" ACTIONS "),y("div",{class:f([t(i).e("btn"),t(i).e("actions")])},[y("div",{class:f(t(i).e("actions__inner"))},[c(t(N),{onClick:s[1]||(s[1]=r=>T("zoomOut"))},{default:L(()=>[c(t(Ze))]),_:1}),c(t(N),{onClick:s[2]||(s[2]=r=>T("zoomIn"))},{default:L(()=>[c(t(Ge))]),_:1}),y("i",{class:f(t(i).e("actions__divider"))},null,2),c(t(N),{onClick:P},{default:L(()=>[(h(),ie(Ne(t(p).icon)))]),_:1}),y("i",{class:f(t(i).e("actions__divider"))},null,2),c(t(N),{onClick:s[3]||(s[3]=r=>T("anticlockwise"))},{default:L(()=>[c(t(Ue))]),_:1}),c(t(N),{onClick:s[4]||(s[4]=r=>T("clockwise"))},{default:L(()=>[c(t(qe))]),_:1})],2)],2),C(" CANVAS "),y("div",{class:f(t(i).e("canvas"))},[(h(!0),x(ee,null,Re(e.urlList,(r,w)=>$e((h(),x("img",{ref_for:!0,ref:S=>g.value[w]=S,key:r,src:r,style:ue(t(F)),class:f(t(i).e("img")),onLoad:le,onError:Z,onMousedown:G},null,46,ut)),[[Ae,w===v.value]])),128))],2),Q(e.$slots,"default")],6)]),_:3})],8,["disabled"]))}}));var ft=Ie(dt,[["__file","/home/runner/work/element-plus/element-plus/packages/components/image-viewer/src/image-viewer.vue"]]);const mt=_e(ft),vt=he({hideOnClickModal:{type:Boolean,default:!1},src:{type:String,default:""},fit:{type:String,values:["","contain","cover","fill","none","scale-down"],default:""},loading:{type:String,values:["eager","lazy"]},lazy:{type:Boolean,default:!1},scrollContainer:{type:ce([String,Object])},previewSrcList:{type:ce(Array),default:()=>ge([])},previewTeleported:{type:Boolean,default:!1},zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},closeOnPressEscape:{type:Boolean,default:!0},zoomRate:{type:Number,default:1.2}}),pt={load:n=>n instanceof Event,error:n=>n instanceof Event,switch:n=>de(n),close:()=>!0,show:()=>!0},gt=["src","loading"],wt={key:0},yt=te({name:"ElImage",inheritAttrs:!1}),ht=te(J(j({},yt),{props:vt,emits:pt,setup(n,{emit:l}){const a=n;let o="";const{t:m}=ke(),k=be("image"),i=Be(),R=nt(),d=I(),g=I(!1),E=I(!0),z=I(!1),v=I(),p=I(),u=B&&"loading"in HTMLImageElement.prototype;let M,$;const K=_(()=>i.style),ae=_(()=>{const{fit:e}=a;return B&&e?{objectFit:e}:{}}),F=_(()=>{const{previewSrcList:e}=a;return Array.isArray(e)&&e.length>0}),ne=_(()=>{const{previewSrcList:e,initialIndex:s}=a;let r=s;return s>e.length-1&&(r=0),r}),A=_(()=>a.loading==="eager"?!1:!u&&a.loading==="lazy"||a.lazy),D=()=>{!B||(E.value=!0,g.value=!1,d.value=a.src)};function se(e){E.value=!1,g.value=!1,l("load",e)}function le(e){E.value=!1,g.value=!0,l("error",e)}function Z(){lt(v.value,p.value)&&(D(),P())}const G=tt(Z,200,!0);function H(){return ve(this,null,function*(){var e;if(!B)return;yield we();const{scrollContainer:s}=a;Qe(s)?p.value=s:et(s)&&s!==""?p.value=(e=document.querySelector(s))!=null?e:void 0:v.value&&(p.value=st(v.value)),p.value&&(M=V(p,"scroll",G),setTimeout(()=>Z(),100))})}function P(){!B||!p.value||!G||(M==null||M(),p.value=void 0)}function W(e){if(!!e.ctrlKey){if(e.deltaY<0)return e.preventDefault(),!1;if(e.deltaY>0)return e.preventDefault(),!1}}function U(){!F.value||($=V("wheel",W,{passive:!1}),o=document.body.style.overflow,document.body.style.overflow="hidden",z.value=!0,l("show"))}function q(){$==null||$(),document.body.style.overflow=o,z.value=!1,l("close")}function T(e){l("switch",e)}return re(()=>a.src,()=>{A.value?(E.value=!0,g.value=!1,P(),H()):D()}),ye(()=>{A.value?H():D()}),(e,s)=>(h(),x("div",{ref_key:"container",ref:v,class:f([t(k).b(),e.$attrs.class]),style:ue(t(K))},[g.value?Q(e.$slots,"error",{key:0},()=>[y("div",{class:f(t(k).e("error"))},Ve(t(m)("el.image.error")),3)]):(h(),x(ee,{key:1},[d.value!==void 0?(h(),x("img",Me({key:0},t(R),{src:d.value,loading:e.loading,style:t(ae),class:[t(k).e("inner"),t(F)&&t(k).e("preview"),E.value&&t(k).is("loading")],onClick:U,onLoad:se,onError:le}),null,16,gt)):C("v-if",!0),E.value?(h(),x("div",{key:1,class:f(t(k).e("wrapper"))},[Q(e.$slots,"placeholder",{},()=>[y("div",{class:f(t(k).e("placeholder"))},null,2)])],2)):C("v-if",!0)],64)),t(F)?(h(),x(ee,{key:2},[z.value?(h(),ie(t(mt),{key:0,"z-index":e.zIndex,"initial-index":t(ne),infinite:e.infinite,"zoom-rate":e.zoomRate,"url-list":e.previewSrcList,"hide-on-click-modal":e.hideOnClickModal,teleported:e.previewTeleported,"close-on-press-escape":e.closeOnPressEscape,onClose:q,onSwitch:T},{default:L(()=>[e.$slots.viewer?(h(),x("div",wt,[Q(e.$slots,"viewer")])):C("v-if",!0)]),_:3},8,["z-index","initial-index","infinite","zoom-rate","url-list","hide-on-click-modal","teleported","close-on-press-escape"])):C("v-if",!0)],64)):C("v-if",!0)],6))}}));var kt=Ie(ht,[["__file","/home/runner/work/element-plus/element-plus/packages/components/image/src/image.vue"]]);const St=_e(kt);export{St as E,Tt as g};
